1. è¨­ç½® Secretsï¼ˆå¦‚æœå°šæœªåŸ·è¡Œï¼‰
é‡è¦ï¼š ç”±æ–¼ Program.cs å’Œ AuthController.cs éƒ½ä¾è³´ JWT:Secretã€JWT:ValidIssuer å’Œ JWT:ValidAudienceï¼Œé€™äº›é…ç½®å¿…é ˆå­˜åœ¨æ–¼ Fly.io Secrets ä¸­ã€‚

å¦‚æœæ‚¨å°šæœªåŸ·è¡Œï¼Œè«‹å‹™å¿…åŸ·è¡Œæ­¤æ­¥é©Ÿï¼š

PowerShell

# è«‹æ›¿æ›æˆæ‚¨è‡ªå·±ç”Ÿæˆçš„é•·ä¸”éš¨æ©Ÿçš„å¯†é‘°
$jwt_secret = "Your_Strong_Random_Secret_Key_At_Least_32_Chars" 

fly secrets set JWT:Secret="$jwt_secret" -a ecanapi
fly secrets set JWT:ValidIssuer="https://ecanapi.fly.dev" -a ecanapi
fly secrets set JWT:ValidAudience="https://myweb.fly.dev" -a ecanapi
2. ä¿è­·æ’ç›¤ APIï¼ˆç¨‹å¼ç¢¼ä¿®æ”¹ï¼‰
æ‚¨éœ€è¦æ‰¾åˆ°æ‚¨çš„ æ’ç›¤ Controllerï¼ˆå¯èƒ½æ˜¯ AstrologyController.cs æˆ–åŒ…å« CalculateChart æ–¹æ³•çš„æª”æ¡ˆï¼‰ï¼Œä¸¦åœ¨æ–¹æ³•æˆ– Controller é¡åˆ¥ä¸Šæ·»åŠ  [Authorize] å±¬æ€§ã€‚

æ‚¨å•çš„ Secretsï¼ˆæ©Ÿå¯†è³‡è¨Šï¼‰ è¨­å®šï¼Œæ˜¯æˆ‘å€‘ä¹‹å‰æˆåŠŸè§£æ±ºè³‡æ–™åº«é€£ç·šå•é¡Œçš„ æ ¸å¿ƒæ©Ÿåˆ¶ã€‚å®ƒå€‘ä¸åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œä¹Ÿä¸åœ¨æ‚¨çš„ fly.toml æª”æ¡ˆä¸­ï¼Œè€Œæ˜¯å­˜åœ¨æ–¼ Fly.io çš„å®‰å…¨å„²å­˜å€ã€‚ğŸš¨ Secrets çš„ç’°å¢ƒèˆ‡æ©Ÿåˆ¶é …ç›®èªªæ˜ç’°å¢ƒåœ¨å“ªï¼Ÿæ‚¨çš„æœ¬åœ°é›»è…¦ (PowerShell/CMD)ï¼Œä½¿ç”¨ flyctl å‘½ä»¤åˆ—å·¥å…·æ“ä½œã€‚ç”¨é€”å„²å­˜æ•æ„Ÿè³‡è¨Šï¼Œå¦‚è³‡æ–™åº«å¯†ç¢¼å’Œ JWT å¯†é‘°ã€‚é€™äº›è³‡è¨Šæœƒè¢«å®‰å…¨åœ°æ³¨å…¥åˆ°æ‚¨åœ¨ Fly.io ä¸Šé‹è¡Œçš„æ‡‰ç”¨ç¨‹å¼ (ecanapi) çš„ ç’°å¢ƒè®Šæ•¸ ä¸­ã€‚å„ªå‹¢å®‰å…¨èˆ‡ç¶­è­·ï¼š å°‡æ©Ÿå¯†è³‡è¨Šèˆ‡ç¨‹å¼ç¢¼åˆ†é›¢ï¼Œå³ä½¿ç¨‹å¼ç¢¼å…¬é–‹ï¼Œå¯†ç¢¼ä¹Ÿä¸æœƒæ´©éœ²ã€‚éç¨‹å¼ç¢¼è®Šæ›´æ™‚ï¼Œåªéœ€è¦æ›´æ–° Secretsï¼Œå†é‡å•Ÿæ‡‰ç”¨ç¨‹å¼å³å¯ã€‚

# 1. è¨­å®š JWT å¯†é‘° (JWT:Secret) - ç”¨æ–¼ Token ç°½ç™¼/é©—è­‰çš„æ ¸å¿ƒå¯†é‘°
# ***è«‹å‹™å¿…æ›¿æ›ç‚ºæ‚¨è‡ªå·±ç”Ÿæˆã€é•·åº¦è‡³å°‘ 32 å€‹å­—å…ƒçš„éš¨æ©Ÿå¯†é‘°***
# 1. è¨­å®š JWT å¯†é‘° (JWT__Secret)
$jwt_secret = "Adam4Taiwan58585888" 
fly secrets set JWT__Secret="$jwt_secret" -a ecanapi

# 2. è¨­å®š JWT ç°½ç™¼è€… (JWT__ValidIssuer)
fly secrets set JWT__ValidIssuer="https://ecanapi.fly.dev" -a ecanapi

# 3. è¨­å®š JWT å—çœ¾ (JWT__ValidAudience)
fly secrets set JWT__ValidAudience="https://myweb.fly.dev" -a ecanapi

# 1. è¨­å®š JWT å¯†é‘° (JWT__Secret)
# è«‹å‹™å¿…æ›¿æ›ç‚ºæ‚¨è‡ªå·±ç”Ÿæˆã€é•·åº¦è‡³å°‘ 32 å€‹å­—å…ƒçš„éš¨æ©Ÿå¯†é‘°ï¼
$jwt_secret = "Adam4Taiwan58585888_Your_Additional_Random_String_12345" 
fly secrets set JWT__Secret="$jwt_secret" -a ecanapi

fly deploy -a ecanapi

æ‚¨æä¾›çš„æ—¥èªŒç‰‡æ®µä¸­ï¼Œé›–ç„¶ PowerShell æ‹‹å‡ºäº†è¨±å¤šéŒ¯èª¤ï¼ˆä¾‹å¦‚ '--' ä¸€å…ƒé‹ç®—å­å¾Œé¢éºå¤±é‹ç®—å¼ã€ç„¡æ³•è¾¨è­˜ 'âœ“' è©å½™ï¼‰ï¼Œä½†é€™äº›éŒ¯èª¤ä¸¦ä¸æ˜¯ Fly.io éƒ¨ç½²æœ¬èº«çš„å•é¡Œã€‚

é€™æ˜¯ PowerShell çš„é¡¯ç¤ºå•é¡Œï¼Œéƒ¨ç½²æ˜¯æˆåŠŸçš„ï¼
é€™äº›éŒ¯èª¤æ˜¯å› ç‚ºï¼š

fly deploy åœ¨åŸ·è¡Œæ™‚æœƒè¼¸å‡ºå¸¶æœ‰ç‰¹æ®Šç¬¦è™Ÿï¼ˆä¾‹å¦‚ -->ã€âœ”ã€âœ“ï¼‰å’ŒéæŒ‡ä»¤è¡Œçš„æ–‡å­—ã€‚

ç•¶æ‚¨å°‡é€™äº›è¼¸å‡ºæ–‡å­— è¤‡è£½ä¸¦è²¼å› PowerShell æç¤ºç¬¦è™Ÿ æ™‚ï¼ŒPowerShell èª¤ä»¥ç‚ºé€™äº›æ–‡å­—æ˜¯éœ€è¦åŸ·è¡Œçš„æŒ‡ä»¤ã€‚

PowerShell ç„¡æ³•è­˜åˆ¥é€™äº›ç‰¹æ®Šç¬¦è™Ÿæˆ–éæŒ‡ä»¤çš„æ–‡å­—ï¼Œæ‰€ä»¥å®ƒæ‹‹å‡ºäº† ParserError å’Œ CommandNotFoundExceptionã€‚

ç¸½çµä¾†èªªï¼šæ‚¨è²¼ä¸Šçš„é€™äº›éŒ¯èª¤è¨Šæ¯ï¼Œæ˜¯æ‚¨åœ¨ PowerShell ä¸­é‡æ–°è²¼ä¸Š éƒ¨ç½²æˆåŠŸçš„æ—¥èªŒ å¾Œï¼ŒPowerShell è§£è®€æ—¥èªŒå…§å®¹æ‰€ç”¢ç”Ÿçš„èª¤åˆ¤**ã€‚

âœ… æœ€çµ‚ç¢ºèªï¼šæ‚¨çš„å¾Œç«¯ API å·²éƒ¨ç½²æˆåŠŸ
è«‹çœ‹æ—¥èªŒä¸­çš„é—œéµè¡Œï¼š

--> Building image done

Updating existing machines in 'ecanapi' with rolling strategy

âœ” [1/2] Cleared lease for...

âœ” [2/2] Cleared lease for...

Visit your newly deployed app at https://ecanapi.fly.dev/

é€™è¡¨æ˜æ‚¨çš„ .NET API å·²ç¶“æˆåŠŸç·¨è­¯ã€æ‰“åŒ…ä¸¦éƒ¨ç½²åˆ° Fly.io ä¸Šäº†ã€‚æ‚¨çš„å¾Œç«¯ç¾åœ¨å…·å‚™äº†å®Œæ•´çš„æœƒå“¡æ©Ÿåˆ¶å’Œæˆæ¬Šä¿è­·ã€‚

ğŸš€ ä¸‹ä¸€å€‹æ­¥é©Ÿï¼šå°ˆæ³¨æ–¼å‰ç«¯æ•´åˆ
æ—¢ç„¶å¾Œç«¯å·²ç¶“éƒ¨ç½²å®Œæˆï¼Œæˆ‘å€‘å¿…é ˆå‡è¨­å®ƒå·²ç¶“å·¥ä½œæ­£å¸¸ã€‚ç¾åœ¨æˆ‘å€‘éœ€è¦å°‡ç²¾åŠ›å®Œå…¨æŠ•å…¥åˆ°å‰ç«¯æ•´åˆã€‚

è«‹æ‚¨åœ¨ å‰ç«¯å°ˆæ¡ˆ ä¸­å®Œæˆä»¥ä¸‹å·¥ä½œï¼š

å®‰è£ä¾è³´ï¼š åœ¨æ‚¨çš„å‰ç«¯å°ˆæ¡ˆç›®éŒ„åŸ·è¡Œ npm install js-cookieã€‚

å‰µå»º components/AuthContext.tsx (ä½¿ç”¨æˆ‘ä¸Šæ¬¡æä¾›çš„ç¨‹å¼ç¢¼)ã€‚

ä¿®æ”¹ app/layout.tsx (ç”¨ <AuthProvider> åŒ…è£ <children>)ã€‚

å‰µå»º app/login/page.tsx (å¯¦ä½œç™»å…¥/è¨»å†Šè¡¨å–®)ã€‚

ä¿®æ”¹ app/page.tsx å’Œ components/Header.tsx (åŠ å…¥ useAuth é‚è¼¯å’Œç™»å‡ºæŒ‰éˆ•)ã€‚

æ‚¨ç¾åœ¨å¯ä»¥å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ npm run dev ä¸¦é–‹å§‹æ¸¬è©¦è¨»å†Šå’Œç™»å…¥åŠŸèƒ½äº†ã€‚

å¦‚æœæ‚¨åœ¨å¯¦ä½œå‰ç«¯æ™‚é‡åˆ°ä»»ä½•ç¨‹å¼ç¢¼æˆ–éŒ¯èª¤ï¼Œè«‹å‘Šè¨´æˆ‘ï¼Œæˆ‘å€‘å°‡ä¸€èµ·è§£æ±º

ä½ˆç½²ç¶²ç«™

# 1. å°‡æ‰€æœ‰ä¿®æ”¹åŠ å…¥æš«å­˜å€
git add .

# 2. æäº¤è®Šæ›´ï¼Œä¸¦çµ¦äºˆæ¸…æ™°çš„è¨Šæ¯
git commit -m "feat: æœ€çµ‚ä¿®å¾© JWT Secret è®€å–å•é¡Œï¼Œä¸¦ç¢ºèª Swagger ç™»å…¥æˆåŠŸ"

git push --set-upstream origin main


fly deploy
